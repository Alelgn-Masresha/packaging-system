import React, { createContext, useContext, useMemo, useState } from 'react';

type LanguageCode = 'en' | 'am';

type Dictionary = Record<string, string>;

const en: Dictionary = {
  dashboard: 'Dashboard',
  customers_orders: 'Customers & Orders',
  track_orders: 'Track Orders',
  customer_history: 'Customer History',
  products: 'Products',
  inventory_management: 'Inventory Management',
  reports: 'Reports',
  welcome_back: "Welcome back! Here's what's happening today.",
  notifications: 'Notifications',
  view_all: 'View all',
  language: 'Language',
  refresh: 'Refresh',
  mark_all_read: 'Mark all as read',
  no_notifications: 'No notifications',
  all_caught_up: 'All caught up!',
  view_all_notifications: 'View all notifications',
  filters: 'Filters',
  date_range: 'Date Range',
  product_type: 'Product Type',
  quick_filters: 'Quick Filters',
  today: 'Today',
  this_week: 'This Week',
  this_month: 'This Month',
  clear_filters: 'Clear Filters',
  sales_summary: 'Sales Summary',
  total_orders: 'Total Orders',
  completed_orders: 'Completed Orders',
  pending_orders: 'Pending Orders',
  total_quantity: 'Total Quantity',
  total_sales: 'Total Sales',
  total_paid_label: 'Total Paid',
  outstanding_label: 'Outstanding',
  sales_trend: 'Sales Trend',
  top_products_time: 'Top Products by Sales (Over Time)',
  order_status_distribution: 'Order Status Distribution',
  report_breakdown: 'Report Breakdown',
  export_pdf: 'Export PDF',
  export_excel: 'Export Excel',
  print: 'Print',
  date: 'Date',
  product_type_col: 'Product Type',
  orders_col: 'Orders',
  quantity_col: 'Quantity',
  sales_col: 'Sales',
  paid_col: 'Paid',
  no_data_found: 'No data found for the selected filters',
  raw_materials_inventory: 'Raw Materials Inventory',
  last_updated: 'Last Updated',
  add_material: 'Add Material',
  inventory_tab: 'Raw Material Inventory',
  transactions_tab: 'Stock Transactions',
  search_materials: 'Search materials...',
  filter: 'Filter',
  total_materials: 'Total Materials',
  material_name: 'Material Name',
  category: 'Category',
  current_stock: 'Current Stock',
  unit: 'Unit',
  min_stock: 'Min. Stock',
  add_quantity: 'Add Quantity',
  actions: 'Actions',
  stock_movement_trend: 'Stock Movement Trend',
  transaction_volume: 'Transaction Volume',
  transaction_types: 'Transaction Types',
  top_materials_by_usage: 'Top Materials by Usage',
  stock_transactions_report: 'Stock Transactions Report',
  detailed_report: 'Detailed report',
  type: 'Type',
  apply: 'Apply',
  no_transactions_found: 'No transactions found',
  loading_transactions: 'Loading transactions...',
  track_manage_orders: 'Track & Manage Orders',
  monitor_manage_payments: 'Monitor order status and manage payments',
  status: 'Status',
  delivery_date: 'Delivery Date',
  order_id: 'Order ID',
  customer: 'Customer',
  product: 'Product',
  size: 'Size',
  payment: 'Payment',
  actions_col: 'Actions',
  update_status: 'Update Status',
  record_payment: 'Record Payment',
  loading_orders: 'Loading orders...',
  no_orders_found: 'No orders found',
  update_order_status: 'Update Order Status',
  new_status: 'New Status',
  cancel: 'Cancel',
  order_label: 'Order',
  record_payment_title: 'Record Payment',
  total_order_value: 'Total Order Value',
  total_paid: 'Total Paid',
  outstanding: 'Outstanding',
  payment_type: 'Payment Type',
  note_advance_only_final: 'Note: This order already has an advance payment. Only final payments can be recorded now.',
  advance_payment: 'Advance Payment',
  already_received: '(Already received)',
  final_payment: 'Final Payment',
  payment_amount: 'Payment Amount',
  reference_number: 'Reference Number',
  record: 'Record',
  // Payment status
  payment_paid: 'Paid',
  payment_partial: 'Partial',
  payment_unpaid: 'Unpaid',
  // Status labels
  status_pending: 'Pending',
  status_in_progress: 'In Progress',
  status_completed: 'Completed',
  status_delivered: 'Delivered',
  status_cancelled: 'Cancelled',
  stock_available: 'Available',
  stock_low: 'Low Stock',
  stock_out: 'Out of Stock',
  // Notification templates
  notif_missed_title: 'Missed Delivery',
  notif_missed_msg: 'Order #{orderId} for {customer} was due {days} day(s) ago',
  notif_due_today_title: 'Due Today',
  notif_due_today_msg: 'Order #{orderId} for {customer} is due for delivery today',
  notif_1day_title: '1 Day Left',
  notif_1day_msg: 'Order #{orderId} for {customer} is due tomorrow',
  notif_2day_title: '2 Days Left',
  notif_2day_msg: 'Order #{orderId} for {customer} is due in 2 days',
  notif_3day_title: '3 Days Left',
  notif_3day_msg: 'Order #{orderId} for {customer} is due in 3 days',
  notif_material_out_title: 'Material Out of Stock',
  notif_material_low_title: 'Material Low Stock',
  notif_material_msg: '{name}: {current} {unit} available · Min {min} {unit}',
};

const am: Dictionary = {
  dashboard: 'ዳሽቦርድ',
  customers_orders: 'ደንበኞች እና ትዕዛዞች',
  track_orders: 'ትዕዛዞችን ክትትል',
  customer_history: 'የደንበኛ ታሪክ',
  products: 'ምርቶች',
  inventory_management: 'እቃ ዝርዝር አስተዳደር',
  reports: 'ሪፖርቶች',
  welcome_back: 'እንኳን በደህና መጡ! ዛሬ የሚከሰቱት እነዚህ ናቸው።',
  notifications: 'ማሳወቂያዎች',
  view_all: 'ሁሉንም ይመልከቱ',
  language: 'ቋንቋ',
  refresh: 'አድስ',
  mark_all_read: 'ሁሉንም እንደተነበበ ምልክት ስጥ',
  no_notifications: 'ማሳወቂያ የለም',
  all_caught_up: 'ሁሉንም አጥብቀዋል!',
  view_all_notifications: 'ሁሉንም ማሳወቂያዎች ይመልከቱ',
  filters: 'ማጣሪያዎች',
  date_range: 'የቀን ክልል',
  product_type: 'የምርት አይነት',
  quick_filters: 'ፈጣን ማጣሪያዎች',
  today: 'ዛሬ',
  this_week: 'ይህ ሳምንት',
  this_month: 'ይህ ወር',
  clear_filters: 'ማጣሪያዎችን አጽዳ',
  sales_summary: 'የሽያጭ ማጠቃለያ',
  total_orders: 'ጠቅላላ ትዕዛዞች',
  completed_orders: 'የተጠናቀቁ ትዕዛዞች',
  pending_orders: 'በመጠባበቅ ላይ ያሉ ትዕዛዞች',
  total_quantity: 'ጠቅላላ ብዛት',
  total_sales: 'ጠቅላላ ሽያጭ',
  total_paid_label: 'የተከፈለ',
  outstanding_label: 'የሚቀር',
  sales_trend: 'የሽያጭ ዝውውር',
  top_products_time: 'ከፍተኛ ሽያጭ ያላቸው ምርቶች (በጊዜ)',
  order_status_distribution: 'የትዕዛዝ ሁኔታ ስርጭት',
  report_breakdown: 'የሪፖርት ክፍፍል',
  export_pdf: 'PDF ወደ አውጣ',
  export_excel: 'Excel ወደ አውጣ',
  print: 'አትም',
  date: 'ቀን',
  product_type_col: 'የምርት አይነት',
  orders_col: 'ትዕዛዞች',
  quantity_col: 'ብዛት',
  sales_col: 'ሽያጭ',
  paid_col: 'የተከፈለ',
  no_data_found: 'ለተመረጡ ማጣሪያዎች መረጃ የለም',
  raw_materials_inventory: 'የግምት ቁሳቁስ ቀሪ መጠን',
  last_updated: 'መጨረሻ የተዘምነው',
  add_material: 'ንጥል ጨምር',
  inventory_tab: 'የቁሳቁስ ዝርዝር',
  transactions_tab: 'የክምችት ዝውውር',
  search_materials: 'ንጥሎችን ፈልግ...',
  filter: 'ማጣሪያ',
  total_materials: 'ጠቅላላ ንጥሎች',
  material_name: 'የንጥል ስም',
  category: 'ምድብ',
  current_stock: 'የአሁኑ ስቶክ',
  unit: 'መለኪያ',
  min_stock: 'አነስተኛ ስቶክ',
  add_quantity: 'መጠን ጨምር',
  actions: 'እርምጃዎች',
  stock_movement_trend: 'የክምችት እንቅስቃሴ',
  transaction_volume: 'የዝውውር ብዛት',
  transaction_types: 'የዝውውር ዓይነቶች',
  top_materials_by_usage: 'በአጠቃቀም ከፍተኛ ንጥሎች',
  stock_transactions_report: 'የክምችት ዝውውር ሪፖርት',
  detailed_report: 'ዝርዝር ሪፖርት',
  type: 'ዓይነት',
  apply: 'ተግብር',
  no_transactions_found: 'ዝውውር አልተገኘም',
  loading_transactions: 'ዝውውሮችን በመጫን ላይ...',
  track_manage_orders: 'ትዕዛዞችን ክትትል እና ክፍያዎችን አስተዳድር',
  monitor_manage_payments: 'የትዕዛዝ ሁኔታ እና ክፍያ አስተዳደር',
  status: 'ሁኔታ',
  delivery_date: 'የመላኪያ ቀን',
  order_id: 'የትዕዛዝ ቁጥር',
  customer: 'ደንበኛ',
  product: 'ምርት',
  size: 'መጠን',
  payment: 'ክፍያ',
  actions_col: 'እርምጃዎች',
  update_status: 'ሁኔታ አዘምን',
  record_payment: 'ክፍያ መዝግብ',
  loading_orders: 'ትዕዛዞችን በመጫን ላይ...',
  no_orders_found: 'ትዕዛዝ አልተገኘም',
  update_order_status: 'የትዕዛዝ ሁኔታ አዘምን',
  new_status: 'አዲስ ሁኔታ',
  cancel: 'ሰርዝ',
  order_label: 'ትዕዛዝ',
  record_payment_title: 'ክፍያ መዝግብ',
  total_order_value: 'ጠቅላላ ዋጋ',
  total_paid: 'ጠቅላላ የተከፈለ',
  outstanding: 'የሚቀር',
  payment_type: 'የክፍያ አይነት',
  note_advance_only_final: 'ማስታወሻ፡ ለዚህ ትዕዛዝ ቀድሞ ቅድሚያ ክፍያ ተቀብሏል። ከእንግዲህ በኋላ መጨረሻ ክፍያ ብቻ ይመዘገባል።',
  advance_payment: 'ቅድሚያ ክፍያ',
  already_received: '(ቀድሞ ተቀብሏል)',
  final_payment: 'መጨረሻ ክፍያ',
  payment_amount: 'የክፍያ መጠን',
  reference_number: 'የማጣቀሻ ቁጥር',
  record: 'መዝግብ',
  // Payment status
  payment_paid: 'ተከፍሏል',
  payment_partial: 'ከፊል ተከፍሏል',
  payment_unpaid: 'አልተከፈለም',
  // Status labels
  status_pending: 'ያልተጀመረ',
  status_in_progress: 'በሂደት ላይ',
  status_completed: 'የተጠናቀቀ',
  status_delivered: 'ተላከ',
  status_cancelled: 'ተሰረዘ',
  stock_available: 'በቂ ግባት',
  stock_low: 'ዝቅተኛ ግባት',
  stock_out: 'አልቋል',
  // Notification templates
  notif_missed_title: 'ጊዜ ያለፈው ትዕዛዝ',
  notif_missed_msg: 'የ#{orderId} የ{customer} ተእዛዝ {days} ቀን አልፎታል!',
  notif_due_today_title: 'ዛሬ የሚረከብ ትዕዛዝ',
  notif_due_today_msg: 'የ#{orderId} ትዕዛዝ ለ{customer} ዛሬ መላክ አለበት!',
  notif_1day_title: '1 ቀን የቀረው ትዕዛዝ',
  notif_1day_msg: 'የ#{orderId} ትዕዛዝ ለ{customer} ነገ ይልካል',
  notif_2day_title: '2 ቀን የቀረው ትዕዛዝ',
  notif_2day_msg: 'የ#{orderId} ትዕዛዝ ለ{customer} በ2 ቀናት ውስጥ መላክ አለበት!',
  notif_3day_title: '3 ቀን የቀረው ትዕዛዝ',
  notif_3day_msg: 'የ#{orderId} ትዕዛዝ ለ{customer} በ3 ቀናት ውስጥ መላክ አለበት!',
  notif_material_out_title: 'የግባት እጥረት',
  notif_material_low_title: 'ያለው ግባት በቂ አይደለም',
  notif_material_msg: '{name} ግባት {current} {unit} ብቻ ይገኛል · ቢያንስ {min} {unit} መኖር አለበት!',
};

const dictionaries: Record<LanguageCode, Dictionary> = { en, am };

interface I18nContextValue {
  lang: LanguageCode;
  setLang: (lang: LanguageCode) => void;
  t: (key: string) => string;
  tp: (key: string, vars: Record<string, string | number>) => string;
}

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

export const I18nProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [lang, setLang] = useState<LanguageCode>('en');

  const t = useMemo(() => {
    return (key: string) => dictionaries[lang][key] ?? key;
  }, [lang]);

  const tp = useMemo(() => {
    return (key: string, vars: Record<string, string | number>) => {
      const template = dictionaries[lang][key] ?? key;
      return Object.keys(vars).reduce((acc, k) => acc.replace(new RegExp(`\\{${k}\\}`, 'g'), String(vars[k])), template);
    };
  }, [lang]);

  const value = useMemo(() => ({ lang, setLang, t, tp }), [lang, t, tp]);
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export const useI18n = () => {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
};